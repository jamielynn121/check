{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Clustering Life Expectancy\"\nauthor: \"David Holt\"\ndate: \"12/11/2018\"\noutput: github_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nlibrary(tidyverse)\nlibrary(TSclust)\n#setwd(\"~/Dropbox/Projects/life_expectancy/\")\ndata <- readxl::read_xlsx(\"Life Expectancy at Birth.xlsx\")\n```\n\n## Dataset\n\nThis data includes Life Expectancies by Country by Year from 1960 - 2015.\n\nThe data includes observations for regions, which I dropped.\n\n```{r}\ndata <-\n  data %>%\n  filter(!is.na(Region))\n```\n\nExamining Countries divided by Region, there seem to be Regions that are very similar intra-Regionally, as well as Regions that are similar inter-Regionally. Rather than simply using Region, I would like to find out if there are more meaningful clusterings, and how those align with Region.\n\n```{r}\ndata %>%\n  ggplot() +\n  geom_line(aes(x = Year, y = `Life Expectancy`, color = Country), show.legend = FALSE) +\n  facet_grid(~Region) +\n  ylab(\"Life Expectancy\") +\n  ylim(0, NA) +\n  theme_minimal()\n```\n\n## Missing Data\n\nI investigated countries with missing years of data. Some were not countries during the entirety of the time period. There were few that had only a small number of missing years, and the number of total countries with missing data was only 28 of 207. For that reason, I removed those countries from the dataset.\n\n```{r}\ndata %>%\n  group_by(Country, Region) %>%\n  summarise(total_missing = sum(is.na(`Life Expectancy`))) %>%\n  filter(total_missing != 0) %>%\n  ggplot() +\n  geom_boxplot(aes(x = Region, y = total_missing), outlier.colour=\"black\", outlier.shape=16,\n               outlier.size=2, notch=FALSE) +\n  ggtitle(\"Number of Missing Years per Country (for Countries with Missing Years)\") +\n  ylab(\"Missing Years\") +\n  ylim(0, NA) +\n  theme_minimal()\n\ncountries_with_missing_data <-\n  data %>%\n  group_by(Country) %>%\n  summarise(total_missing = sum(is.na(`Life Expectancy`))) %>%\n  filter(total_missing != 0) %>%\n  pull(Country)\n\ndata_clean <-\n  data %>%\n  filter(!(Country %in% countries_with_missing_data))\n```\n\n## Clustering\n\nI used three different clustering methods: Euclidean distance, Dynamic Time Warping and a model-based ARMA method. I chose Euclidean distance because DTW wasn't necessary (year-over-year differences weren't stretched or compressed) and the ARMA method produced far fewer clusters. You can see the distribution of Life Expectancies is very skewed left, which represents the presence of the two clusters lower than the majority of countries.\n\nThere is a very large cluster, but the two other clusters are both significantly sized.\n\n```{r}\nhist(data_clean$`Life Expectancy`)\n\ndata_matrix <-\n  data_clean %>%\n  select(Year, Country, `Life Expectancy`) %>%\n  spread(key = Year, value = `Life Expectancy`) %>%\n  select(-Country) %>%\n  as.matrix()\n\n# Euclidean distance\ndissimilarities_euclidean <-\n  diss(data_matrix, \"EUCL\")\n\nnames(dissimilarities_euclidean) <-\n  data_clean %>%\n  select(Year, Country, `Life Expectancy`) %>%\n  spread(key = Year, value = `Life Expectancy`) %>%\n  pull(Country)\n\n#perform hierachical clustering to the dist object\nhc_eucl <- hclust(dissimilarities_euclidean)\n\n#show the results\nplot(hc_eucl)\nclusters_euclidean <- cutree(hc_eucl, 3)\n\ntable(clusters_euclidean)\n```\n\n## Initial Results\n\nWe can see that the two clusters with lower than average Life Expectancy are both largely made up of Sub-Saharan countries. Research revealed that both wars and medical epidemics affected those countries, as well as the Northern African and Pacific countries included in the Middle Life Expectancy clusters.\n\n```{r}\ndata_clean_clustered <-\n  data_clean %>%\n  inner_join(tibble(Country = names(clusters_euclidean),\n                    cluster = as.vector(clusters_euclidean)))\n\ndata_clean_clustered$cluster <-\n  data_clean_clustered$cluster %>%\n  recode(`1` = \"Low\", `3` = \"Mid\", `2` = \"High\")\n\ndata_clean_clustered %>%\n  group_by(Region, Country, cluster) %>%\n  summarise() %>%\n  group_by(Region) %>%\n  summarise(`Low Life Expectancy` = sum(cluster == \"Low\"),\n            `Middle Life Expectancy` = sum(cluster == \"Mid\"),\n            `High Life Expectancy` = sum(cluster == \"High\"))\n```\n\n## Graphical Results\n\nWe can see that the countries in the High Life Expectancy cluster have moved together, though across a wide number of starting Life Expectancies. For countries with Low Life Expectancies, they are primarily clustered based on their low initial life expectancy, but they also are countries that suffered from negative effects during the 1970s-1990s. Finally, those countries with Mid Life Expectancies include countries like Iraq and Afghanistan, which saw significant effects from wars in the 2000s.\n\n```{r}\ndata_clean_clustered %>%\n  ggplot() +\n  geom_line(aes(x = Year, y = `Life Expectancy`, color = Country), show.legend = FALSE) +\n  facet_grid(~cluster) +\n  theme_minimal()\n```",
    "created" : 1544565139439.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "606042510",
    "id" : "FFB05B98",
    "lastKnownWriteTime" : 1544565256,
    "last_content_update" : 1544565256440,
    "path" : "~/BZAN/Test/Report.Rmd",
    "project_path" : "Report.Rmd",
    "properties" : {
        "last_setup_crc32" : "6AFFC60C98c3d7de"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}